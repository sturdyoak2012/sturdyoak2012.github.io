<!DOCTYPE html>
<head>
	<title>Pictures</title>
		<link rel="shortcut icon" type="image/png" href="favicon.png"/>
	<link rel="stylesheet" href="style.css">
	<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-132703009-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-132703009-1');
</script>

<script src="https://www.gstatic.com/firebasejs/5.8.2/firebase.js"></script>
<script src="https://www.gstatic.com/firebasejs/5.8.2/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/5.8.2/firebase-database.js"></script>
<script>
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyA7-t4UBOoWgYq65D74vbluIwuuDotKlG8",
    authDomain: "jacobnie-4a6fd.firebaseapp.com",
    databaseURL: "https://jacobnie-4a6fd.firebaseio.com",
    projectId: "jacobnie-4a6fd",
    storageBucket: "jacobnie-4a6fd.appspot.com",
    messagingSenderId: "202057575155"
  };
  firebase.initializeApp(config);
</script>

<script>

  var request = new XMLHttpRequest();
  request.open('GET', 'https://ipapi.co/json', true);
  request.onload = function () {
    if (request.status >= 200 && request.status < 400) {
      // Success!
      var data = JSON.parse(request.responseText);
      
        firebase.database().ref("/analytics/").child(btoa(data.ip)).child("visits").once("value").then(function(snapshot) {
        	firebase.database().ref("/analytics/").child(btoa(data.ip)).update({
        		visits:(snapshot.val()||0) + 1,
        		data:data,
				lastVisit:{
	          		page:window.location.pathname,
	          		timestamp:new Date() + ""
	          	}
	        });
	        firebase.database().ref("/analytics/").child(btoa(data.ip)).child("history").push({
	          	page:window.location.pathname,
	          	timestamp:new Date() + ""
	          });
        })
      
    }
  };
  request.onerror = function () {
    // There was a connection error of some sort
  };
  request.send();
</script>
</head>
<body>
<div id="container">
<div id="menu">
	<a href='index.html'><div id='jacob'><p>Jacob Nie</p></div></a>
	<a href='about.html'><div id='pages'><p>about</p></div></a>
	<a href='pictures.html'><div id='pages'><p>pictures</p></div></a>
	<a href='outdoors.html'><div id='pages'><p>outdoors</p></div></a>
	<a href='physics.html'><div id='pages'><p>physics</p></div></a>
</div>
<div id="page">

	<div style="height: 10vh;"></div>

	<div style="text-align:left;"><button id="btn">Random Image</button></div>
	<br><br>

	<img id="img" style="height: 70vh">
	<p id="caption">Loading...</p>


	<script src="lib/js/jquery.min.js"></script>
	<script>
		var images = 389; //number of images
		var path = "pictures/img/";
		
		function showImage(num) {
			var num = num || window.location.hash.substring(1);
			if (num == "" || num == "#" || isNaN(num) || parseInt(num) < 1 || parseInt(num) > images) {
				//the hash is not a valid number

				window.location.hash = randInt(1, images);
				var num = num || window.location.hash.substring(1);

			}
			$("#img").attr("src", path + num + ".jpg");
			$("#caption").text("Image " + num);
			
		}

		showImage();
		$(window).on("hashchange", function() {
			showImage();
		})
		//Add a click listener and also "click" the button once
		$("#btn").click(function() {
			window.location.hash = randInt(1, images);


		});
		
		function randInt(min, max) {
		  min = Math.ceil(min);
		  max = Math.floor(max) + 1;//change from exclusive max to inclusive max
		  return Math.floor(Math.random() * (max - min)) + min; //The maximum is exclusive and the minimum is inclusive
		}
		
		
	</script>
	<p>Want to know when/where a picture was taken?  Send me an email with the image number!</p>



</div>

</div>
</body>


</html>